/**
 * Copyright 2015 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.list.min","./kendo.mobile.scroller.min"],e)}(function(){return function(e,t){function n(e,t,n){return n?t.substring(0,e).split(n).length-1:0}function i(e,t,i){return t.split(i)[n(e,t,i)]}function o(e,t,i,o){var a=t.split(o);return a.splice(n(e,t,o),1,i),o&&""!==a[a.length-1]&&a.push(""),a.join(o)}var a=window.kendo,r=a.support,l=a.caret,s=a._activeElement,u=r.placeholder,c=a.ui,d=c.List,p=a.keys,f=a.data.DataSource,h="aria-disabled",v="aria-readonly",m="k-state-default",g="disabled",k="readonly",w="k-state-focused",_="k-state-selected",b="k-state-disabled",y="k-state-hover",$=".kendoAutoComplete",M="mouseenter"+$+" mouseleave"+$,V=e.proxy,S=d.extend({init:function(t,n){var i,o,r=this;r.ns=$,n=e.isArray(n)?{dataSource:n}:n,d.fn.init.call(r,t,n),t=r.element,n=r.options,n.placeholder=n.placeholder||t.attr("placeholder"),u&&t.attr("placeholder",n.placeholder),r._wrapper(),r._loader(),r._dataSource(),r._ignoreCase(),t[0].type="text",i=r.wrapper,r._popup(),t.addClass("k-input").on("keydown"+$,V(r._keydown,r)).on("paste"+$,V(r._search,r)).on("focus"+$,function(){r._prev=r._accessor(),r._placeholder(!1),i.addClass(w)}).on("focusout"+$,function(){r._change(),r._placeholder(),i.removeClass(w)}).attr({autocomplete:"off",role:"textbox","aria-haspopup":!0}),r._enable(),r._old=r._accessor(),t[0].id&&t.attr("aria-owns",r.ul[0].id),r._aria(),r._placeholder(),r._initList(),o=e(r.element).parents("fieldset").is(":disabled"),o&&r.enable(!1),a.notify(r)},options:{name:"AutoComplete",enabled:!0,suggest:!1,template:"",groupTemplate:"#:data#",fixedGroupTemplate:"#:data#",dataTextField:"",minLength:1,delay:200,height:200,filter:"startswith",ignoreCase:!0,highlightFirst:!1,separator:null,placeholder:"",animation:{},value:null},_dataSource:function(){var e=this;e.dataSource&&e._refreshHandler?e._unbindDataSource():e._progressHandler=V(e._showBusy,e),e.dataSource=f.create(e.options.dataSource).bind("progress",e._progressHandler)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.listView.setDataSource(this.dataSource)},events:["open","close","change","select","filtering","dataBinding","dataBound"],setOptions:function(e){var t=this._listOptions(e);d.fn.setOptions.call(this,e),t.dataValueField=t.dataTextField,this.listView.setOptions(t),this._accessors(),this._aria()},_editable:function(e){var t=this,n=t.element,i=t.wrapper.off($),o=e.readonly,a=e.disable;o||a?(i.addClass(a?b:m).removeClass(a?m:b),n.attr(g,a).attr(k,o).attr(h,a).attr(v,o)):(i.addClass(m).removeClass(b).on(M,t._toggleHover),n.removeAttr(g).removeAttr(k).attr(h,!1).attr(v,!1))},close:function(){var e=this,t=e.listView.focus();t&&t.removeClass(_),e.popup.close()},destroy:function(){var e=this;e.element.off($),e.wrapper.off($),d.fn.destroy.call(e)},refresh:function(){this.listView.refresh()},select:function(e){this._select(e)},search:function(e){var t,n=this,o=n.options,a=o.ignoreCase,r=o.separator;e=e||n._accessor(),clearTimeout(n._typingTimeout),r&&(e=i(l(n.element)[0],e,r)),t=e.length,(!t||t>=o.minLength)&&(n._open=!0,n.listView.filter(!0),n._filterSource({value:a?e.toLowerCase():e,operator:o.filter,field:o.dataTextField,ignoreCase:a}))},suggest:function(e){var i,o=this,a=o._last,r=o._accessor(),u=o.element[0],c=l(u)[0],f=o.options.separator,h=r.split(f),v=n(c,r,f),m=c;return a==p.BACKSPACE||a==p.DELETE?(o._last=t,t):(e=e||"","string"!=typeof e&&(e[0]&&(e=o.dataSource.view()[d.inArray(e[0],o.ul[0])]),e=e?o._text(e):""),0>=c&&(c=r.toLowerCase().indexOf(e.toLowerCase())+1),i=r.substring(0,c).lastIndexOf(f),i=i>-1?c-(i+f.length):c,r=h[v].substring(0,i),e&&(e=""+e,i=e.toLowerCase().indexOf(r.toLowerCase()),i>-1&&(e=e.substring(i+r.length),m=c+e.length,r+=e),f&&""!==h[h.length-1]&&h.push("")),h[v]=r,o._accessor(h.join(f||"")),u===s()&&l(u,c,m),t)},value:function(e){return e===t?this._accessor():(this.listView.value(e),this._accessor(e),this._old=this._accessor(),t)},_click:function(e){var n=e.item,i=this.element;return this.trigger("select",{item:n})?(this.close(),t):(this._select(n),this._blur(),l(i,i.val().length),t)},_initList:function(){var t=this,n=t.options.virtual,i=!!n,o=V(t._listBound,t),r={autoBind:!1,selectable:!0,dataSource:t.dataSource,click:e.proxy(t._click,this),change:e.proxy(t._listChange,this),activate:V(t._activateItem,t),deactivate:V(t._deactivateItem,t),dataBinding:function(){t.trigger("dataBinding"),t._angularItems("cleanup")},dataBound:o,listBound:o};r=e.extend(t._listOptions(),r,"object"==typeof n?n:{}),r.dataValueField=r.dataTextField,t.listView=i?new a.ui.VirtualList(t.ul,r):new a.ui.StaticList(t.ul,r),t.listView.value(t.options.value)},_listBound:function(){var e,n,i=this,o=i.popup,a=i.options,r=i.dataSource.flatView(),l=r.length,u=i.element[0]===s();i._angularItems("compile"),i.listView.value([]),i.listView.focus(-1),i.listView.filter(!1),i._calculateGroupPadding(i._height(l)),o.position(),l&&(n=this.listView.focus(),a.highlightFirst&&!n&&i.listView.first(),a.suggest&&u&&i.suggest(r[0])),i._open&&(i._open=!1,e=l?"open":"close",i._typingTimeout&&!u&&(e="close"),o[e](),i._typingTimeout=t),i._touchScroller&&i._touchScroller.reset(),i._hideBusy(),i._makeUnselectable(),i.trigger("dataBound")},_listChange:function(){this.listView.filter()||this._selectValue(this.listView.selectedDataItems()[0])},_selectValue:function(e){var t=this.options.separator,n="";e&&(n=this._text(e)),null===n&&(n=""),t&&(n=o(l(this.element)[0],this._accessor(),n,t)),this._prev=n,this._accessor(n),this._placeholder()},_accessor:function(e){var n=this,i=n.element[0];return e===t?(e=i.value,i.className.indexOf("k-readonly")>-1&&e===n.options.placeholder?"":e):(i.value=null===e?"":e,n._placeholder(),t)},_keydown:function(e){var t=this,n=e.keyCode,i=t.popup.visible(),o=this.listView.focus();if(t._last=n,n===p.DOWN)i&&this._move(o?"next":"first"),e.preventDefault();else if(n===p.UP)i&&this._move(o?"prev":"last"),e.preventDefault();else if(n===p.ENTER||n===p.TAB){if(n===p.ENTER&&i&&e.preventDefault(),i&&o){if(t.trigger("select",{item:o}))return;this._select(o)}this._blur()}else n===p.ESC?(i&&e.preventDefault(),t.close()):(t._search(),t._typing=!0)},_move:function(e){this.listView[e](),this.options.suggest&&this.suggest(this.listView.focus())},_hideBusy:function(){var e=this;clearTimeout(e._busy),e._loading.hide(),e.element.attr("aria-busy",!1),e._busy=null},_showBusy:function(){var e=this;e._busy||(e._busy=setTimeout(function(){e.element.attr("aria-busy",!0),e._loading.show()},100))},_placeholder:function(e){if(!u){var n,i=this,o=i.element,a=i.options.placeholder;if(a){if(n=o.val(),e===t&&(e=!n),e||(a=n!==a?n:""),n===i._old&&!e)return;o.toggleClass("k-readonly",e).val(a),a||o[0]!==document.activeElement||l(o[0],0,0)}}},_search:function(){var e=this;clearTimeout(e._typingTimeout),e._typingTimeout=setTimeout(function(){e._prev!==e._accessor()&&(e._prev=e._accessor(),e.search())},e.options.delay)},_select:function(e){this.listView.select(e)},_loader:function(){this._loading=e('<span class="k-icon k-loading" style="display:none"></span>').insertAfter(this.element)},_toggleHover:function(t){e(t.currentTarget).toggleClass(y,"mouseenter"===t.type)},_wrapper:function(){var e,t=this,n=t.element,i=n[0];e=n.parent(),e.is("span.k-widget")||(e=n.wrap("<span />").parent()),e.attr("tabindex",-1),e.attr("role","presentation"),e[0].style.cssText=i.style.cssText,n.css({width:"100%",height:i.style.height}),t._focused=t.element,t.wrapper=e.addClass("k-widget k-autocomplete k-header").addClass(i.className)}});c.plugin(S)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});