/**
 * Copyright 2015 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.data.min"],e)}(function(){return function(e,t){function n(e){return e[e.length-1]}function i(e){return e instanceof Array?e:[e]}function r(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e}function a(e,t,n){return Math.ceil(e*t/n)}function o(e,t,n){var i=document.createElement(n||"div");return t&&(i.className=t),e.appendChild(i),i}function s(){var t,n=e('<div class="k-popup"><ul class="k-list"><li class="k-item"><li></ul></div>');return n.css({position:"absolute",left:"-200000px",visibility:"hidden"}),n.appendTo(document.body),t=parseFloat(v.getComputedStyles(n.find(".k-item")[0],["line-height"])["line-height"]),n.remove(),t}function l(e,t,n){return{down:e*n,up:e*(t-1-n)}}function u(e,t){var n=(e.listScreens-1-e.threshold)*t,i=e.threshold*t;return function(e,t,r){return t>r?n>t-e.top:0===e.top||t-e.top>i}}function c(e,t){return function(n){return t(e.scrollTop,n)}}function d(e){return function(t,n){return e(t.items,t.index,n),t}}function p(e,t){v.support.browser.msie&&10>v.support.browser.version?e.style.top=t+"px":(e.style.webkitTransform="translateY("+t+"px)",e.style.transform="translateY("+t+"px)")}function h(t,n){return function(i,r){for(var a=0,o=i.length;o>a;a++)t(i[a],r[a],n),r[a].item&&(this.trigger(V,{item:e(i[a]),data:r[a].item,ns:v.ui}),r[a].index===this._selectedIndex&&this.select(this._selectedIndex))}}function f(e,t){var n;return t>0?(n=e.splice(0,t),e.push.apply(e,n)):(n=e.splice(t,-t),e.unshift.apply(e,n)),n}function m(n,i,r){var a=r.template;n=e(n),i.item||(a=r.placeholderTemplate),this.angular("cleanup",function(){return{elements:[n]}}),n.attr("data-uid",i.item?i.item.uid:"").attr("data-offset-index",i.index).html(a(i.item||{})),n.toggleClass(A,i.current),n.toggleClass(P,i.selected),n.toggleClass("k-first",i.newGroup),n.toggleClass("k-loading-item",!i.item),0!==i.index&&i.newGroup&&e("<div class="+I+"></div>").appendTo(n).html(r.groupTemplate({group:i.group})),i.top!==t&&p(n[0],i.top),this.angular("compile",function(){return{elements:[n],data:[{dataItem:i.item,group:i.group,newGroup:i.newGroup}]}})}function g(e,t){var n,i,r,a=t.length,o=[];for(i=0;e.length>i;i++)for(n=e[i],r=0;a>r;r++)n===t[r]&&o.push({index:i,item:n});return o}var v=window.kendo,_=v.ui,w=_.Widget,b=_.DataBoundWidget,y=e.proxy,k="k-virtual-wrap",x="k-virtual-list",C="k-virtual-content",T="k-list",S="k-group-header",D="k-virtual-item",F="k-item",E="k-height-container",I="k-group",P="k-state-selected",A="k-state-focused",M="k-state-hover",H="change",z="click",O="listBound",V="itemChange",B="activate",L="deactivate",R=".VirtualList",N=b.extend({init:function(t,n){var r=this;r._listCreated=!1,r._fetching=!1,r._filter=!1,w.fn.init.call(r,t,n),r.options.itemHeight||(r.options.itemHeight=s()),n=r.options,r.element.addClass(T+" "+x).attr("role","listbox"),r.content=r.element.wrap("<div unselectable='on' class='"+C+"'></div>").parent(),r.wrapper=r.content.wrap("<div class='"+k+"'></div>").parent(),r.header=r.content.before("<div class='"+S+"'></div>").prev(),r.element.on("mouseenter"+R,"li:not(.k-loading-item)",function(){e(this).addClass(M)}).on("mouseleave"+R,"li",function(){e(this).removeClass(M)}),r._values=i(r.options.value),r._selectedDataItems=[],r._selectedIndexes=[],r._rangesList={},r._activeDeferred=null,r._promisesList=[],r._optionID=v.guid(),r.setDataSource(n.dataSource),r.content.on("scroll"+R,v.throttle(function(){r._renderItems()},n.delay)),r._selectable()},options:{name:"VirtualList",autoBind:!0,delay:100,height:null,listScreens:4,threshold:.5,itemHeight:null,oppositeBuffer:1,type:"flat",selectable:!1,value:[],dataValueField:null,template:"#:data#",placeholderTemplate:"loading...",groupTemplate:"#:group#",fixedGroupTemplate:"fixed header template",valueMapper:null},events:[H,z,O,V,B,L],setOptions:function(e){w.fn.setOptions.call(this,e),this._selectProxy&&this.options.selectable===!1?this.element.off(z,"."+D,this._selectProxy):!this._selectProxy&&this.options.selectable&&this._selectable(),this.refresh()},items:function(){return e(this._items)},destroy:function(){this.wrapper.off(R),this.dataSource.unbind(H,this._refreshHandler),w.fn.destroy.call(this)},setDataSource:function(t){var n,i=this,r=t||{};r=e.isArray(r)?{data:r}:r,r=v.data.DataSource.create(r),i.dataSource?(i.dataSource.unbind(H,i._refreshHandler),i.dataSource.unbind(H,i._rangeChangeHandler),n=i.value(),i.value([]),i.mute(function(){i.value(n)})):(i._refreshHandler=e.proxy(i.refresh,i),i._rangeChangeHandler=e.proxy(i.rangeChange,i)),i.dataSource=r.bind(H,i._refreshHandler).bind(H,i._rangeChangeHandler),0!==i.dataSource.view().length?i.refresh():i.options.autoBind&&i.dataSource.fetch()},rangeChange:function(){var e=this,t=e.dataSource.page();e.isBound()&&e._rangeChange===!0&&e._lastPage!==t&&(e._lastPage=t,e.trigger(O))},refresh:function(e){var t,n=this,i=e&&e.action;n._mute||(n._fetching?n._renderItems&&n._renderItems(!0):(n._filter&&n.focus(0),n._createList(),i||!n._values.length||n._filter?(n._lastPage=n.dataSource.page(),n._listCreated=!0,n.trigger(O)):n.value(n._values,!0).done(function(){n._lastPage=n.dataSource.page(),n._listCreated=!0,n.trigger(O)})),"itemchange"===i&&(t=g(n._selectedDataItems,e.items),t.length&&n.trigger("selectedItemChange",{items:t})),n._fetching=!1)},removeAt:function(e){return this._selectedIndexes.splice(e,1),this._values.splice(e,1),{position:e,dataItem:this._selectedDataItems.splice(e,1)[0]}},setValue:function(e){this._values=i(e)},value:function(n,r){var a=this;return n===t?a._values.slice():(n=i(n),"multiple"===a.options.selectable&&a.select().length&&n.length&&a.select(-1),a._valueDeferred&&"resolved"!==a._valueDeferred.state()||(a._valueDeferred=e.Deferred()),n.length||a.select(-1),a._values=n,(a.isBound()&&!a._mute||r)&&a._prefetchByValue(n),a._valueDeferred)},_prefetchByValue:function(e){var n,a,o,s=this,l=s._dataView,u=s._valueGetter,c=!1,d=[];for(a=0;e.length>a;a++)for(o=0;l.length>o;o++)n=l[o].item,n&&(c=r(n)?e[a]===n:e[a]===u(n),c&&d.push(o));if(d.length===e.length)return s._values=[],s.select(d),t;if("function"!=typeof s.options.valueMapper)throw Error("valueMapper is not provided");s.options.valueMapper({value:"multiple"===this.options.selectable?e:e[0],success:function(e){s._values=[],s._selectedIndexes=[],s._selectedDataItems=[],e=i(e),e.length||(e=[-1]),s.select(e)}})},deferredRange:function(t){var n=this.dataSource,i=this.itemCount,r=this._rangesList,a=e.Deferred(),o=[],s=Math.floor(t/i)*i,l=Math.ceil(t/i)*i,u=l===s?[l]:[s,l];return e.each(u,function(t,a){var s,l=a+i,u=r[a];u&&u.end===l?s=u.deferred:(s=e.Deferred(),r[a]={end:l,deferred:s},n._multiplePrefetch(a,i,function(){s.resolve()})),o.push(s)}),e.when.apply(e,o).then(function(){a.resolve()}),a},prefetch:function(t){var n=this,i=this.itemCount,r=!n._promisesList.length;return n._activeDeferred||(n._activeDeferred=e.Deferred(),n._promisesList=[]),e.each(t,function(e,t){var r=Math.floor(t/i)*i;n._promisesList.push(n.deferredRange(r))}),r&&e.when.apply(e,n._promisesList).done(function(){n._activeDeferred.resolve(),n._activeDeferred=null,n._promisesList=[]}),n._activeDeferred},_findDataItem:function(e){var t,n,i=this.dataSource.view();if("group"===this.options.type)for(n=0;i.length>n;n++){if(t=i[n].items,!(e>=t.length))return t[e];e-=t.length}return i[e]},selectedDataItems:function(){return this._selectedDataItems.slice()},scrollTo:function(e){this.content.scrollTop(e)},scrollToIndex:function(e){this.scrollTo(e*this.options.itemHeight)},focus:function(i){var r,a,o,s,l,u,c=this.options.itemHeight,d=this._optionID,p=!0;if(i===t)return s=this.element.find("."+A),s.length?s:null;if("function"==typeof i)for(o=this.dataSource.flatView(),l=0;o.length>l;l++)if(i(o[l])){i=l;break}return i instanceof Array&&(i=n(i)),isNaN(i)?(r=e(i),a=parseInt(e(r).attr("data-offset-index"),10)):(a=i,r=this._getElementByIndex(a)),-1===a?(this.element.find("."+A).removeClass(A),this._focusedIndex=t,t):(r.length?(r.hasClass(A)&&(p=!1),this._focusedIndex!==t&&(s=this._getElementByIndex(this._focusedIndex),s.removeClass(A).removeAttr("id"),p&&this.trigger(L)),this._focusedIndex=a,r.addClass(A).attr("id",d),u=this._getElementLocation(a),"top"===u?this.scrollTo(a*c):"bottom"===u?this.scrollTo(a*c+c-this.screenHeight):"outScreen"===u&&this.scrollTo(a*c),p&&this.trigger(B)):(this._focusedIndex=a,this.items().removeClass(A),this.scrollToIndex(a)),t)},focusIndex:function(){return this._focusedIndex},first:function(){this.scrollTo(0),this.focus(0)},last:function(){var e=this.dataSource.total();this.scrollTo(this.heightContainer.offsetHeight),this.focus(e)},prev:function(){var e,n=this._focusedIndex;return!isNaN(n)&&n>0?(n-=1,this.focus(n),e=this.focus(),e&&e.hasClass("k-loading-item")&&(n+=1,this.focus(n)),n):t},next:function(){var e,n=this._focusedIndex,i=this.dataSource.total()-1;return!isNaN(n)&&i>n?(n+=1,this.focus(n),e=this.focus(),e&&e.hasClass("k-loading-item")&&(n-=1,this.focus(n)),n):t},select:function(e){var i,r,a,o=this,s="multiple"!==o.options.selectable,l=!!o._activeDeferred,u=[];return e===t?o._selectedIndexes.slice():(i=o._getIndecies(e),o._filter&&!s&&o._deselectFiltered(i)||!i.length||s&&!o._filter&&n(i)===n(this._selectedIndexes)||(u=o._deselect(i),s&&(o._activeDeferred=null,l=!1,i.length&&(i=[n(i)])),a=function(){var e=o._select(i);o.focus(i),(e.length||u.length)&&o.trigger(H,{added:e,removed:u}),o._valueDeferred&&o._valueDeferred.resolve()},r=o.prefetch(i),l||(r?r.done(a):a())),t)},isBound:function(){return this._listCreated},mute:function(e){this._mute=!0,y(e(),this),this._mute=!1},filter:function(e){return e===t?this._filter:(this._filter=e,this._rangeChange=!0,t)},skipUpdate:e.noop,_getElementByIndex:function(t){return this.items().filter(function(n,i){return t===parseInt(e(i).attr("data-offset-index"),10)})},_clean:function(){this.result=t,this._lastScrollTop=t,this._lastPage=t,e(this.heightContainer).remove(),this.heightContainer=t,this.element.empty()},_height:function(){var e=!!this.dataSource.view().length,t=this.options.height,n=this.options.itemHeight,i=this.dataSource.total();return e?t/n>i&&(t=i*n):t=0,t},_screenHeight:function(){var e=this._height(),t=this.content;t.height(e),this.screenHeight=e},_getElementLocation:function(e){var t,n=this.content.scrollTop(),i=this.screenHeight,r=this.options.itemHeight,a=e*r,o=a+r,s=n+i;return t=a===n-r||o>n&&n>a?"top":a===s||s>a&&o>s?"bottom":a>=n&&n+(i-r)>=a?"inScreen":"outScreen"},_templates:function(){var e,t={template:this.options.template,placeholderTemplate:this.options.placeholderTemplate,groupTemplate:this.options.groupTemplate,fixedGroupTemplate:this.options.fixedGroupTemplate};for(e in t)"function"!=typeof t[e]&&(t[e]=v.template(t[e]));this.templates=t},_generateItems:function(e,t){for(var n,i=[],r=this.options.itemHeight+"px";t-->0;)n=document.createElement("li"),n.tabIndex=-1,n.className=D+" "+F,n.setAttribute("role","option"),n.style.height=r,n.style.minHeight=r,e.appendChild(n),i.push(n);return i},_saveInitialRanges:function(){var t,n=this.dataSource._ranges,i=e.Deferred();for(i.resolve(),this._rangesList={},t=0;n.length>t;t++)this._rangesList[n[t].start]={end:n[t].end,deferred:i}},_createList:function(){{var t=this,n=t.content.get(0),i=t.options,r=t.dataSource;r.total()}t._listCreated&&t._clean(),t._saveInitialRanges(),t._screenHeight(),t._buildValueGetter(),t.itemCount=a(t.screenHeight,i.listScreens,i.itemHeight),t.itemCount>r.total()&&(t.itemCount=r.total()),t._templates(),t._items=t._generateItems(t.element[0],t.itemCount),t._setHeight(i.itemHeight*r.total()),t.options.type=(r.group()||[]).length?"group":"flat","flat"===t.options.type?t.header.hide():t.header.show(),t.getter=t._getter(function(){t._renderItems(!0)}),t._onScroll=function(e,n){var i=t._listItems(t.getter);return t._fixedHeader(e,i(e,n))},t._renderItems=t._whenChanged(c(n,t._onScroll),d(t._reorderList(t._items,e.proxy(m,t)))),t._renderItems(),t._calculateGroupPadding(t.screenHeight)},_setHeight:function(e){var t,n,i=this.heightContainer;if(i?t=i.offsetHeight:i=this.heightContainer=o(this.content[0],E),e!==t)for(i.innerHTML="";e>0;)n=Math.min(e,25e4),o(i).style.height=n+"px",e-=n},_getter:function(){var e=null,t=this.dataSource,n=t.skip(),i=this.options.type,r=this.itemCount,a={};return function(o,s){var l,u,c,d,p,h,f,m,g=this;if(t.inRange(s,r)){if(n!==s&&(g._mute=!0,g._fetching=!0,g._rangeChange=!0,t.range(s,r),n=s,g._rangeChange=!1,g._fetching=!1,g._mute=!1),"group"===i){if(!a[s])for(u=a[s]=[],c=t.view(),d=0,p=c.length;p>d;d++)for(h=c[d],f=0,m=h.items.length;m>f;f++)u.push({item:h.items[f],group:h.value});l=a[s][o-s]}else l=t.view()[o-s];return l}return e!==s&&(e=s,n=s,g._fetching=!0,g._getterDeferred&&g._getterDeferred.reject(),g._getterDeferred=g.deferredRange(s),g._getterDeferred.then(function(){var e=g._indexConstraint(g.content[0].scrollTop);g._getterDeferred=null,e>=s&&s+r>=e&&(g._fetching=!0,g._rangeChange=!0,t.range(s,r),g._rangeChange=!1)})),null}},_fixedHeader:function(e,t){var n,i=this.currentVisibleGroup,r=this.options.itemHeight,a=Math.floor((e-t.top)/r),o=t.items[a];return o&&o.item&&(n=o.group,n!==i&&(this.header[0].innerHTML=n||"",this.currentVisibleGroup=n)),t},_itemMapper:function(e,t,n){var i,a=this.options.type,o=this.options.itemHeight,s=this._focusedIndex,l=!1,u=!1,c=!1,d=null,p=!1,h=this._valueGetter;if("group"===a&&(e&&(c=0===t||this._currentGroup&&this._currentGroup!==e.group,this._currentGroup=e.group),d=e?e.group:null,e=e?e.item:null),n.length&&e)for(i=0;n.length>i;i++)if(p=r(e)?n[i]===e:n[i]===h(e)){n.splice(i,1),l=!0;break}return s===t&&(u=!0),{item:e?e:null,group:d,newGroup:c,selected:l,current:u,index:t,top:t*o}},_range:function(e){var t,n,i,r=this.itemCount,a=this._values.slice(),o=[];for(this._view={},this._currentGroup=null,n=e,i=e+r;i>n;n++)t=this._itemMapper(this.getter(n,e),n,a),o.push(t),this._view[t.index]=t;return this._dataView=o,o},_getDataItemsCollection:function(e,t){var n=this._range(this._listIndex(e,t));return{index:n.length?n[0].index:0,top:n.length?n[0].top:0,items:n}},_listItems:function(){var t=this.screenHeight,n=this.options,i=u(n,t);return e.proxy(function(e,t){var n=this.result,r=this._lastScrollTop;return!t&&n&&i(n,e,r)||(n=this._getDataItemsCollection(e,r)),this._lastScrollTop=e,this.result=n,n},this)},_whenChanged:function(e,t){var n;return function(i){var r=e(i);r!==n&&(n=r,t(r,i))}},_reorderList:function(t,n){var i=this,r=t.length,a=-1/0;return n=e.proxy(h(n,this.templates),this),function(e,o,s){var l,u,c=o-a;s||Math.abs(c)>=r?(l=t,u=e):(l=f(t,c),u=c>0?e.slice(-c):e.slice(0,-c)),n(l,u,i._listCreated),a=o}},_bufferSizes:function(){var e=this.options;return l(this.screenHeight,e.listScreens,e.oppositeBuffer)},_indexConstraint:function(e){var t=this.itemCount,n=this.options.itemHeight,i=this.dataSource.total();return Math.min(Math.max(i-t,0),Math.max(0,Math.floor(e/n)))},_listIndex:function(e,t){var n,i=this._bufferSizes();return n=e-(e>t?i.down:i.up),this._indexConstraint(n)},_selectable:function(){this.options.selectable&&(this._selectProxy=e.proxy(this,"_clickHandler"),this.element.on(z+R,"."+D,this._selectProxy))},_getIndecies:function(e){var t,n,i=[];if("function"==typeof e)for(t=this.dataSource.flatView(),n=0;t.length>n;n++)if(e(t[n])){i.push(n);break}return"number"==typeof e&&i.push(e),e instanceof jQuery&&(e=parseInt(e.attr("data-offset-index"),10),isNaN(e)||i.push(e)),e instanceof Array&&(i=e),i},_deselect:function(n){var i,r,a,o,s,l,u=[],c=this._selectedIndexes,d=0,p=this.options.selectable,h=0;if(-1===n[d]){for(s=0;c.length>s;s++)r=c[s],this._getElementByIndex(r).removeClass(P),u.push({index:r,position:s,dataItem:this._selectedDataItems[s]});return this._values=[],this._selectedDataItems=[],this._selectedIndexes=[],n.splice(0,n.length),u}if(p===!0)i=n[d],r=c[d],r!==t&&i!==r&&(this._getElementByIndex(r).removeClass(P),u.push({index:r,position:d,dataItem:this._selectedDataItems[d]}),this._values=[],this._selectedDataItems=[],this._selectedIndexes=[]);else if("multiple"===p)for(l=0;n.length>l;l++)if(d=e.inArray(n[l],c),r=c[d],r!==t){if(o=this._getElementByIndex(r),!o.hasClass("k-state-selected"))continue;o.removeClass(P),this._values.splice(d,1),this._selectedIndexes.splice(d,1),a=this._selectedDataItems.splice(d,1),n.splice(l,1),u.push({index:r,position:d+h,dataItem:a}),h++,l--}return u},_deselectFiltered:function(t){for(var n,i,r,a,o=this.element[0].children,s=this._values,l=[],u=0;t.length>u;u++){for(r=-1,i=t[u],n=this._valueGetter(this._view[i].item),a=0;s.length>a;a++)if(n==s[a]){r=a;break}r>-1&&(l.push(this.removeAt(r)),e(o[i]).removeClass("k-state-selected"))}return l.length?(this.trigger("change",{added:[],removed:l}),!0):!1},_select:function(t){var n,i,a=this,o="multiple"!==this.options.selectable,s=this.dataSource,l=this.itemCount,u=this._valueGetter,c=[];return o&&(a._selectedIndexes=[],a._selectedDataItems=[],a._values=[]),i=s.skip(),e.each(t,function(e,t){var o=l>t?1:Math.floor(t/l)+1,d=(o-1)*l;a.mute(function(){s.range(d,l),n=a._findDataItem([t-d]),a._selectedIndexes.push(t),a._selectedDataItems.push(n),a._values.push(r(n)?n:u(n)),c.push({index:t,dataItem:n}),a._getElementByIndex(t).addClass(P),s.range(i,l)})}),c},_clickHandler:function(t){var n=e(t.currentTarget);!t.isDefaultPrevented()&&n.attr("data-uid")&&this.trigger(z,{item:n})},_buildValueGetter:function(){this._valueGetter=v.getter(this.options.dataValueField)},_calculateGroupPadding:function(e){var t=this.items().first(),n=this.header,i=0;n[0]&&"none"!==n[0].style.display&&("auto"!==e&&(i=v.support.scrollbar()),i+=parseFloat(t.css("border-right-width"),10)+parseFloat(t.children(".k-group").css("right"),10),n.css("padding-right",i))}});v.ui.VirtualList=N,v.ui.plugin(N)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});