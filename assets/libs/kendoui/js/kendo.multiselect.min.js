/**
 * Copyright 2015 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.list.min","./kendo.mobile.scroller.min"],e)}(function(){return function(e,t){function n(e,t){var n;if(null===e&&null!==t||null!==e&&null===t)return!1;if(n=e.length,n!==t.length)return!1;for(;n--;)if(e[n]!==t[n])return!1;return!0}var i=window.kendo,a=i.ui,r=a.List,o=i.keys,s=i._activeElement,l=i.data.ObservableArray,u=e.proxy,c="id",d="li",h="accept",f="filter",p="rebind",m="open",g="close",v="change",_="progress",b="select",w="aria-disabled",y="aria-readonly",k="k-state-focused",x="k-loading-hidden",C="k-state-hover",T="k-state-disabled",S="disabled",D="readonly",I=".kendoMultiSelect",F="click"+I,M="keydown"+I,E="mouseenter"+I,V="mouseleave"+I,O=E+" "+V,P=/"/g,A=e.isArray,H=["font-family","font-size","font-stretch","font-style","font-weight","letter-spacing","text-transform","line-height"],z=r.extend({init:function(t,n){var a,o,s=this;s.ns=I,r.fn.init.call(s,t,n),s._optionsMap={},s._customOptions={},s._wrapper(),s._tagList(),s._input(),s._textContainer(),s._loader(),s._tabindex(s.input),t=s.element.attr("multiple","multiple").hide(),n=s.options,n.placeholder||(n.placeholder=t.data("placeholder")),a=t.attr(c),a&&(s._tagID=a+"_tag_active",a+="_taglist",s.tagList.attr(c,a)),s._aria(a),s._dataSource(),s._ignoreCase(),s._popup(),s._tagTemplate(),s._initList(),s._reset(),s._enable(),s._placeholder(),n.autoBind?s.dataSource.fetch():n.value&&s._preselect(n.value),o=e(s.element).parents("fieldset").is(":disabled"),o&&s.enable(!1),i.notify(s)},_preselect:function(t,n){var a=this;A(t)||t instanceof i.data.ObservableArray||(t=[t]),(e.isPlainObject(t[0])||t[0]instanceof i.data.ObservableObject||!a.options.dataValueField)&&(a._retrieveData=!0,a.dataSource.data(t),a.value(n||a._initialValues))},options:{name:"MultiSelect",tagMode:"multiple",enabled:!0,autoBind:!0,autoClose:!0,highlightFirst:!0,dataTextField:"",dataValueField:"",filter:"startswith",ignoreCase:!0,minLength:0,delay:100,value:null,maxSelectedItems:null,placeholder:"",height:200,animation:{},itemTemplate:"",tagTemplate:"",groupTemplate:"#:data#",fixedGroupTemplate:"#:data#"},events:[m,g,v,b,"filtering","dataBinding","dataBound"],setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.listView.setDataSource(this.dataSource),this.options.autoBind&&this.dataSource.fetch()},setOptions:function(e){var t=this._listOptions(e);r.fn.setOptions.call(this,e),this._normalizeOptions(t),this.listView.setOptions(t),this._accessors(),this._aria(this.tagList.attr(c)),this._tagTemplate()},currentTag:function(e){var n=this;return e===t?n._currentTag:(n._currentTag&&(n._currentTag.removeClass(k).removeAttr(c),n.input.removeAttr("aria-activedescendant")),e&&(e.addClass(k).attr(c,n._tagID),n.input.attr("aria-activedescendant",n._tagID)),n._currentTag=e,t)},dataItems:function(){return this.listView.selectedDataItems()},destroy:function(){var e=this,t=e.ns;clearTimeout(e._busy),clearTimeout(e._typingTimeout),e.wrapper.off(t),e.tagList.off(t),e.input.off(t),r.fn.destroy.call(e)},_activateItem:function(){r.fn._activateItem.call(this),this.currentTag(null)},_normalizeOptions:function(e){var t=this.options.itemTemplate||this.options.template,n=e.itemTemplate||t||e.template;n||(n="#:"+i.expr(e.dataTextField,"data")+"#"),e.template=n},_initList:function(){var t=this,n=t.options.virtual,a=!!n,r=u(t._listBound,t),o={autoBind:!1,selectable:"multiple",dataSource:t.dataSource,click:u(t._click,t),change:u(t._listChange,t),activate:u(t._activateItem,t),deactivate:u(t._deactivateItem,t),dataBinding:function(){t.trigger("dataBinding"),t._angularItems("cleanup")},dataBound:r,listBound:r,selectedItemChange:u(t._selectedItemChange,t)};o=e.extend(t._listOptions(),o,"object"==typeof n?n:{}),t._normalizeOptions(o),t.listView=a?new i.ui.VirtualList(t.ul,o):new i.ui.StaticList(t.ul,o),t.listView.value(t._initialValues||t.options.value)},_listChange:function(e){this._state===p&&(this._state="",e.added=[]),this._selectValue(e.added,e.removed)},_selectedItemChange:function(e){var t,n,i=e.items;for(n=0;i.length>n;n++)t=i[n],this.tagList.children().eq(t.index).children("span:first").html(this.tagTextTemplate(t.item))},_wrapperMousedown:function(t){var n=this,a="input"!==t.target.nodeName.toLowerCase(),r=e(t.target),o=r.hasClass("k-select")||r.hasClass("k-icon");o&&(o=!r.closest(".k-select").children(".k-i-arrow-s").length),!a||o&&i.support.mobileOS||t.preventDefault(),o||(n.input[0]!==s()&&a&&n.input.focus(),0===n.options.minLength&&n.open())},_inputFocus:function(){this._placeholder(!1),this.wrapper.addClass(k)},_inputFocusout:function(){var e=this;clearTimeout(e._typingTimeout),e.wrapper.removeClass(k),e._placeholder(!e.listView.selectedDataItems()[0],!0),e.close(),e._state===f&&(e._state=h,e.listView.filter(!1),e.listView.skipUpdate(!0)),e.element.blur()},_removeTag:function(e){var n,i=this,a=i._state,r=e.index(),o=i.listView,s=o.value()[r],l=i._customOptions[s];l!==t||a!==h&&a!==f||(l=i._optionsMap[s]),l!==t?(n=i.element[0].children[l],n.removeAttribute("selected"),n.selected=!1,o.removeAt(r),e.remove()):o.select(o.select()[r]),i.currentTag(null),i._change(),i._close()},_tagListClick:function(t){var n=e(t.currentTarget);n.children(".k-i-arrow-s").length||this._removeTag(n.closest(d))},_editable:function(t){var n=this,i=t.disable,a=t.readonly,r=n.wrapper.off(I),o=n.tagList.off(I),s=n.element.add(n.input.off(I));a||i?(i?r.addClass(T):r.removeClass(T),s.attr(S,i).attr(D,a).attr(w,i).attr(y,a)):(r.removeClass(T).on(O,n._toggleHover).on("mousedown"+I+" touchend"+I,u(n._wrapperMousedown,n)),n.input.on(M,u(n._keydown,n)).on("paste"+I,u(n._search,n)).on("focus"+I,u(n._inputFocus,n)).on("focusout"+I,u(n._inputFocusout,n)),s.removeAttr(S).removeAttr(D).attr(w,!1).attr(y,!1),o.on(E,d,function(){e(this).addClass(C)}).on(V,d,function(){e(this).removeClass(C)}).on(F,"li.k-button .k-select",u(n._tagListClick,n)))},_close:function(){var e=this;e.options.autoClose?e.close():e.popup.position()},close:function(){this.popup.close()},open:function(){var e=this;e._request&&(e._retrieveData=!1),e._retrieveData||!e.listView.isBound()||e._state===h?(e._open=!0,e._state=p,e._retrieveData=!1,e.listView.filter(!1),e.listView.skipUpdate(!0),e._filterSource()):e._allowSelection()&&(e.popup.open(),e._focusItem())},toggle:function(e){e=e!==t?e:!this.popup.visible(),this[e?m:g]()},refresh:function(){this.listView.refresh()},_listBound:function(){var e=this,n=e.dataSource.flatView(),i=e.dataSource.page(),a=n.length;e._angularItems("compile"),e._render(n),e._calculateGroupPadding(e._height(a)),e._open&&(e._open=!1,e.toggle(a)),e.popup.position(),!e.options.highlightFirst||i!==t&&1!==i||e.listView.first(),e._touchScroller&&e._touchScroller.reset(),e._hideBusy(),e._makeUnselectable(),e.trigger("dataBound")},search:function(e){var t,n,i=this,a=i.options,r=a.ignoreCase,o=a.filter,s=a.dataTextField,l=i.input.val();a.placeholder===l&&(l=""),clearTimeout(i._typingTimeout),e="string"==typeof e?e:l,n=e.length,(!n||n>=a.minLength)&&(i.listView.filter(!0),i._state=f,i._open=!0,t={value:r?e.toLowerCase():e,field:s,operator:o,ignoreCase:r},i._filterSource(t,i._retrieveData),i._retrieveData=!1)},value:function(e){var n=this,i=n.listView.value().slice(),a=n.options.maxSelectedItems;return e===t?i:(e=n._normalizeValues(e),null!==a&&e.length>a&&(e=e.slice(0,a)),n.listView.value(e),n._old=e,n._fetchData(),t)},_setOption:function(e,t){var n=this.element[0].children[this._optionsMap[e]];n&&(t?n.setAttribute("selected","selected"):n.removeAttribute("selected"),n.selected=t)},_fetchData:function(){var e=this,t=!!e.dataSource.view().length,n=0===e.listView.value().length;n||e._request||e._fetch||t||(e._fetch=!0,e.dataSource.fetch().done(function(){e._fetch=!1}))},_dataSource:function(){var e=this,t=e.element,n=e.options,a=n.dataSource||{};a=A(a)?{data:a}:a,a.select=t,a.fields=[{field:n.dataTextField},{field:n.dataValueField}],e.dataSource&&e._refreshHandler?e._unbindDataSource():e._progressHandler=u(e._showBusy,e),e.dataSource=i.data.DataSource.create(a).bind(_,e._progressHandler)},_reset:function(){var t=this,n=t.element,i=n.attr("form"),a=i?e("#"+i):n.closest("form");a[0]&&(t._resetHandler=function(){setTimeout(function(){t.value(t._initialValues),t._placeholder()})},t._form=a.on("reset",t._resetHandler))},_initValue:function(){var e=this.options.value||this.element.val();this._old=this._initialValues=this._normalizeValues(e)},_normalizeValues:function(t){var n=this;return null===t?t=[]:t&&e.isPlainObject(t)?t=[n._value(t)]:t&&e.isPlainObject(t[0])?t=e.map(t,function(e){return n._value(e)}):A(t)||t instanceof l||(t=[t]),t},_change:function(){var e=this,t=e.value();n(t,e._old)||(e._old=t.slice(),e.trigger(v),e.element.trigger(v))},_click:function(e){var n=e.item;return this.trigger(b,{item:n})?(this._close(),t):(this._select(n),this._change(),this._close(),t)},_keydown:function(n){var a=this,r=n.keyCode,s=a._currentTag,l=a.listView.focus(),u=a.input.val(),c=i.support.isRtl(a.wrapper),d=a.popup.visible();if(r===o.DOWN){if(n.preventDefault(),!d)return a.open(),l||this.listView.first(),t;l?(this.listView.next(),this.listView.focus()||this.listView.last()):this.listView.first()}else if(r===o.UP)d&&(l&&this.listView.prev(),this.listView.focus()||a.close()),n.preventDefault();else if(r===o.LEFT&&!c||r===o.RIGHT&&c)u||(s=s?s.prev():e(a.tagList[0].lastChild),s[0]&&a.currentTag(s));else if(r===o.RIGHT&&!c||r===o.LEFT&&c)!u&&s&&(s=s.next(),a.currentTag(s[0]?s:null));else if(r===o.ENTER&&d){if(l){if(a.trigger(b,{item:l}))return a._close(),t;a._select(l)}a._change(),a._close(),n.preventDefault()}else r===o.ESC?(d?n.preventDefault():a.currentTag(null),a.close()):r===o.HOME?d?this.listView.first():u||(s=a.tagList[0].firstChild,s&&a.currentTag(e(s))):r===o.END?d?this.listView.last():u||(s=a.tagList[0].lastChild,s&&a.currentTag(e(s))):r!==o.DELETE&&r!==o.BACKSPACE||u?(clearTimeout(a._typingTimeout),setTimeout(function(){a._scale()}),a._search()):(r!==o.BACKSPACE||s||(s=e(a.tagList[0].lastChild)),s&&s[0]&&a._removeTag(s))},_hideBusy:function(){var e=this;clearTimeout(e._busy),e.input.attr("aria-busy",!1),e._loading.addClass(x),e._request=!1,e._busy=null},_showBusyHandler:function(){this.input.attr("aria-busy",!0),this._loading.removeClass(x)},_showBusy:function(){var e=this;e._request=!0,e._busy||(e._busy=setTimeout(u(e._showBusyHandler,e),100))},_placeholder:function(e,n){var a=this,r=a.input,o=s();e===t&&(e=!1,r[0]!==o&&(e=!a.listView.selectedDataItems()[0])),a._prev="",r.toggleClass("k-readonly",e).val(e?a.options.placeholder:""),r[0]!==o||n||i.caret(r[0],0,0),a._scale()},_scale:function(){var e,t=this,n=t.wrapper,i=n.width(),a=t._span.text(t.input.val());n.is(":visible")?e=a.width()+25:(a.appendTo(document.documentElement),i=e=a.width()+25,a.appendTo(n)),t.input.width(e>i?i:e)},_option:function(e,n,a){var r="<option";return e!==t&&(e+="",-1!==e.indexOf('"')&&(e=e.replace(P,"&quot;")),r+=' value="'+e+'"'),a&&(r+=" selected"),r+=">",n!==t&&(r+=i.htmlEncode(n)),r+="</option>"},_render:function(e){var t,n,i,a,r,o,s=this.listView.selectedDataItems(),l=this.listView.value(),u=e.length,c="";for(l.length!==s.length&&(s=this._buildSelectedItems(l)),r={},o={},a=0;u>a;a++)n=e[a],i=this._value(n),t=this._selectedItemIndex(i,s),-1!==t&&s.splice(t,1),o[i]=a,c+=this._option(i,this._text(n),-1!==t);if(s.length)for(a=0;s.length>a;a++)n=s[a],i=this._value(n),r[i]=u,o[i]=u,u+=1,c+=this._option(i,this._text(n),!0);this._customOptions=r,this._optionsMap=o,this.element.html(c)},_buildSelectedItems:function(e){var t,n,i=this.options.dataValueField,a=this.options.dataTextField,r=[];for(n=0;e.length>n;n++)t={},t[i]=e[n],t[a]=e[n],r.push(t);return r},_selectedItemIndex:function(e,t){for(var n=this._value,i=0;t.length>i;i++)if(e===n(t[i]))return i;return-1},_search:function(){var e=this;e._typingTimeout=setTimeout(function(){var t=e.input.val();e._prev!==t&&(e._prev=t,e.search(t))},e.options.delay)},_allowSelection:function(){var e=this.options.maxSelectedItems;return null===e||e>this.listView.value().length},_angularTagItems:function(t){var n=this;n.angular(t,function(){return{elements:n.tagList[0].children,data:e.map(n.dataItems(),function(e){return{dataItem:e}})}})},_selectValue:function(e,t){var n,i,a,r=this,o=r.value(),s=r.dataSource.total(),l=r.tagList,u=r._value;if(r._angularTagItems("cleanup"),"multiple"===r.options.tagMode){for(a=t.length-1;a>-1;a--)n=t[a],l[0].removeChild(l[0].children[n.position]),r._setOption(u(n.dataItem),!1);for(a=0;e.length>a;a++)i=e[a],l.append(r.tagTemplate(i.dataItem)),r._setOption(u(i.dataItem),!0)}else(!r._maxTotal||s>r._maxTotal)&&(r._maxTotal=s),l.html(""),o.length&&l.append(r.tagTemplate({values:o,dataItems:r.dataItems(),maxTotal:r._maxTotal,currentTotal:s}));r._angularTagItems("compile"),r._placeholder()},_select:function(e){var t=this;t._state===p&&(t._state=""),t._allowSelection()&&(this.listView.select(e),t._placeholder(),t._state===f&&(t._state=h,t.listView.filter(!1),t.listView.skipUpdate(!0)))},_input:function(){var t=this,n=t.element[0].accessKey,i=t._innerWrapper.children("input.k-input");i[0]||(i=e('<input class="k-input" style="width: 25px" />').appendTo(t._innerWrapper)),t.element.removeAttr("accesskey"),t._focused=t.input=i.attr({accesskey:n,autocomplete:"off",role:"listbox","aria-expanded":!1})},_tagList:function(){var t=this,n=t._innerWrapper.children("ul");n[0]||(n=e('<ul role="listbox" unselectable="on" class="k-reset"/>').appendTo(t._innerWrapper)),t.tagList=n},_tagTemplate:function(){var e,t=this,n=t.options,a=n.tagTemplate,r=n.dataSource,o="multiple"===n.tagMode;t.element[0].length&&!r&&(n.dataTextField=n.dataTextField||"text",n.dataValueField=n.dataValueField||"value"),e=o?i.template("#:"+i.expr(n.dataTextField,"data")+"#",{useWithBlock:!1}):i.template("#:values.length# item(s) selected"),t.tagTextTemplate=a=a?i.template(a):e,t.tagTemplate=function(e){return'<li class="k-button" unselectable="on"><span unselectable="on">'+a(e)+'</span><span unselectable="on" class="k-select"><span unselectable="on" class="k-icon '+(o?"k-i-close":"k-i-arrow-s")+'">'+(o?"delete":"open")+"</span></span></li>"}},_loader:function(){this._loading=e('<span class="k-icon k-loading '+x+'"></span>').insertAfter(this.input)},_textContainer:function(){var t=i.getComputedStyles(this.input[0],H);t.position="absolute",t.visibility="hidden",t.top=-3333,t.left=-3333,this._span=e("<span/>").css(t).appendTo(this.wrapper)},_wrapper:function(){var t=this,n=t.element,i=n.parent("span.k-multiselect");i[0]||(i=n.wrap('<div class="k-widget k-multiselect k-header" unselectable="on" />').parent(),i[0].style.cssText=n[0].style.cssText,i[0].title=n[0].title,e('<div class="k-multiselect-wrap k-floatwrap" unselectable="on" />').insertBefore(n)),t.wrapper=i.addClass(n[0].className).css("display",""),t._innerWrapper=e(i[0].firstChild)}});a.plugin(z)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});